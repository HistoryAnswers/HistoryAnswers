if(typeof Prototype=="undefined"){alert("SapphireLib: Prototype could not be found.")}if(Prototype.Version<"1.6"){alert("SapphireLib: Prototype 1.6.0 is required.")}var SapphireLib={Version:"1.0",SapphirePrefix:"/Sapphire"};Windows.maxZIndex=1500;(function(){function a(g){var f=g.clone(),e=g.length,d=0,c=0;for(e=g.length;e>0;e--){d=Math.min(Math.floor(Math.random()*(e)),e-1);if((e-1)!=d){c=f[e-1];f[e-1]=f[d];f[d]=c}}return f}Object.extend(Array,{randomize:a});Object.extend(Array.prototype,{randomize:a.methodize()});function b(){var h=$A([]),f;for(var d=0,e=arguments.length;d<e;d++){f=arguments[d];if(f.length||(Object.isArray(f)&&!("callee" in f))){for(var c=0,g=f.length;c<g;c++){h.push(f[c])}}else{h.push(f)}}return h}Object.extend(SapphireLib,{elemArray:b});window.$EA=b})();(function(){function a(k,l,j){var m=8;if(Object.isUndefined(l)){l=false}if(typeof k==="undefined"){m=0}else{if(k===null){m=1}else{if(typeof k==="boolean"){m=4}else{if(Object.isArray(k)){m=5}else{if(Object.isHash(k)){m=6}else{if(Object.isFunction(k)){m=7}else{if(!l&&typeof k==="string"){m=3}else{if(!isNaN(k)){m=2}else{if(typeof k==="string"){m=3}}}}}}}}}return Object.isNumber(j)?Math.min(j,m):m}function b(k,j){return k<j?-1:k>j?1:0}function g(l,j){var m=a(l,false),k=a(j,false),n=b(m,k);if(n!==0){return n}if(m<2){return 0}if(m===2){return b(Number(l),Number(j))}return b(l,j)}function d(l,j){var m=a(l,false),k=a(j,false),n=b(m,k);if(n!==0){return n}if(m<2){return 0}if(m===2){return b(Number(l),Number(j))}if(m===3){return b(l.toLowerCase(),j.toLowerCase())}return b(l,j)}function e(l,j){var m=a(l,false,2),k=a(j,false,2),n=b(m,k);if(n!==0){return n}if(m<2){return 0}return b(l.toString(),j.toString())}function h(l,j){var m=a(l,false,2),k=a(j,false,2),n=b(m,k);if(n!==0){return n}if(m<2){return 0}return b(l.toString().toLowerCase(),j.toString().toLowerCase())}function i(l,j){var m=a(l,true),k=a(j,true),n=b(m,k);if(n!==0){return n}if(m<2){return 0}if(m===2){return b(Number(l),Number(j))}return b(l.toString(),j.toString())}function c(l,j){var m=a(l,true),k=a(j,true),n=b(m,k);if(n!==0){return n}if(m<2){return 0}if(m===2){return b(Number(l),Number(j))}return b(l.toString().toLowerCase(),j.toString().toLowerCase())}function f(j){return function(l,k){return j(l,k)*-1}}Object.extend(SapphireLib,{TypePrecedenceIndex:a,NormalComparator:g,CaseInsensitiveNormalComparator:d,StringComparator:e,CaseInsensitiveStringComparator:h,NumericComparator:i,CaseInsensitiveNumericComparator:c,ReverseComparator:f})})();var List=(function(){function a(){return this._array.length}function h(){return this._array.length===0}function f(c){if(isNaN(c)){return false}return(c>=0&&c<this._array.length)}function d(c){return this._array[c]}function k(c,n){if(n&&!isNaN(c)&&this.checkIndex(c)){this._array[c]=n}}function m(n,c){if(!n){return null}if(typeof c==="undefined"){return this.push(n)}if(isNaN(c)){return this.push(n)}if(c<0){return this.unshift(n)}if(c>=this._array.length){return this.push(n)}this._array.splice(c,0,n);return this._array.length}function i(c){if(isNaN(c)){return this._array.shift()}if(this.checkIndex(c)){var n=this._array[c];this._array.splice(c,1);return n}return null}function b(n){var c=this.indexOf(n);if(c>=0){return this.remove(c)}return null}function l(){return"#<List:"+this._array.inspect()+">"}function e(c){return this.indexOf(c)>=0}var j=Class.create({initialize:function g(c){this._array=Object.isArray(c)?c.toArray():[]},length:a,size:a,isEmpty:h,checkIndex:f,add:m,remove:i,removeObj:b,inspect:l,set:k,get:d,contains:e,include:e});[Array.prototype,Enumerable].each(function(c){Object.keys(c).each(function(o){var n=c[o];if(n&&!j.prototype[o]){j.prototype[o]=function(){return n.apply(this._array,arguments)}}})});["indexOf","lastIndexOf","concat","reverse","shift","slice","join","push","unshift","pop"].each(function(c){if(!j.prototype[c]){j.prototype[c]=function(){return this._array[c].apply(this._array,arguments)}}});return j})();var ArrayList=List;var SortedList=(function(){function f(q,v,c,r){var s=typeof r==="undefined"?0:r,n=q?q.length-1:-1,u=s,o=null,t=null,p=c?c:SapphireLib.NormalComparator;while(s<=n){u=(s+n)>>>1;o=q[u];t=p(o,v);if(t<0){s=u+1}else{if(t>0){n=u-1}else{return u}}}return -(s+1)}function d(){return this.comparatorreversed?SapphireLib.ReverseComparator(this.comparator):this.comparator}function m(n,c){return this.push(n)}function l(){return"#<SortedList:"+this._array.inspect()+">"}function h(){var c=arguments.length;while(--c>=0){this.addOne(arguments[c])}return this._array.length}function b(n){if(this._array.length===0){this._array.push(n);return 0}var c=this._array.search(n,this.getComparator());if(c>=0){if(!this.allowDuplicates){return -c-1}this._array.splice(c,0,n);return c}else{this._array.splice(-c-1,0,n);return -c-1}}function j(o,p){var q=(typeof p==="undefined")?0:p;if(q<0){q=this._array.length+q}if(q<0){q=0}var n=this.getComparator();var c=this._array.search(o,n,q);if(c<=q){return c}while(c>q&&n(this._array[c-1],o)===0){c--}return c}function a($super,n,c){if(!n){return this.comparatorreversed?this.last():this.first()}return $super(n,c)}function i($super,n,c){if(!n){return this.comparatorreversed?this.first():this.last()}return $super(n,c)}function e(c){if(c!==false){this.comparatorreversed=!this.comparatorreversed;return this._array._reverse()}else{return this._array.toArray()._reverse()}}function k(){throw new Error("set() not supported on Sorted constructs")}var g=Class.create(List,{initialize:function($super,n,o){var c=1;$super();if(Object.isUndefined(this.allowDuplicates)){this.allowDuplicates=true}this.comparator=Object.isFunction(arguments[c])?arguments[c++]:this._defaultcomparator();this.comparatorreversed=false;this._array.search=f.methodize();if(Object.isArray(arguments[c])){arguments[c].each(this.addOne,this)}},_defaultcomparator:function(){return SapphireLib.NormalComparator},getComparator:d,add:m,push:h,unshift:h,set:k,addOne:b,inspect:l,indexOf:j,min:a,max:i,reverse:e});g.binarySearch=f;g.search=f;return g})();var SortedArray=SortedList;var CaseInsensitiveSortedList=Class.create(SortedList,{inspect:function(){return"#<CaseInsensitiveSortedList:"+this._array.inspect()+">"},_defaultcomparator:function(){return SapphireLib.CaseInsensitiveNormalComparator}});var CaseInsensitiveSortedArray=CaseInsensitiveSortedList;var SortedSet=Class.create(SortedList,{initialize:function($super,a,b){this.allowDuplicates=false;$super(a,b)},inspect:function(){return"#<SortedSet:"+this._array.inspect()+">"}});var CaseInsensitiveSortedSet=Class.create(CaseInsensitiveSortedList,{initialize:function($super,a,b){this.allowDuplicates=false;$super(a,b)},inspect:function(){return"#<CaseInsensitiveSortedSet:"+this._array.inspect()+">"}});var HashMap=Class.create(Hash,{initialize:function($super,a){$super(a)},clear:function(){this._object={}},isEmpty:function(){return this.size()===0},_convertKey:function(a){return a},containsKey:function(a){return !!this._object[a]},containsValue:function(a){return typeof this.index(a)!=="undefined"},put:function(b,a){return this.set(b,a)},remove:function(a){return this.unset(a)},pairs:function(){return this.collect()},inspect:function(){return"#<HashMap:{"+this.map(function(a){return a.map(Object.inspect).join(": ")}).join(", ")+"}>"},sortWith:function(c,b,a){return this.map(function(e,d){return{value:e,criteria:Object.isFunction(b)?b.call(a,e,d):e.key}}).sort(function(g,f){var e=g.criteria,d=f.criteria;return c.call(a,e,d)}).pluck("value")}});var Map=HashMap;var AbstractCaseInsensitiveMapDecorator={initialize:function($super,a){$super();if(a&&Object.isHash(a)){a.each(function(b){this.set(b.key,b.value)},this)}else{if(a){this.update(a)}}},_convertKey:function(a){return String(a).toLowerCase()},containsKey:function($super,a){return $super(this._convertKey(a))},get:function($super,a){return $super(this._convertKey(a))},set:function($super,a,b){return $super(this._convertKey(a),b)},remove:function($super,a){return $super(this._convertKey(a))},unset:function($super,a){return $super(this._convertKey(a))}};var CaseInsensitiveHashMap=Class.create(HashMap,AbstractCaseInsensitiveMapDecorator);CaseInsensitiveHashMap.addMethods({inspect:function(){return"#<CaseInsensitiveHashMap:{"+this.map(function(a){return a.map(Object.inspect).join(": ")}).join(", ")+"}>"}});var AbstractLinkedMapDecorator=(function(){function a($super,h,f){if(Object.isUndefined(this._order)){this._order=this._backingorder()}$super();if(f instanceof List){f=f.toArray()}if(Object.isArray(f)){var i=$A(f).each(function(j){if(Object.isHash(h)){this.put(j,h.get(j));return}if(h[j]){this.put(j,h[j]);return}},this);var g=Object.isHash(h)?h.keys():Object.keys(h);g.each(function(j){if(!this.containsKey(j)){if(Object.isHash(h)){this.put(j,h.get(j));return}if(h[j]){this.put(j,h[j]);return}}},this)}else{if(h&&Object.isHash(h)){h.each(function(j){this.set(j.key,j.value)},this)}else{if(h){this.update(h)}}}}function b(){return new List()}function c(f){this._order.each(function(g){var h=this.get(g),i=[g,h];i.key=g;i.value=h;f(i)},this)}function e($super,f,g){if(!this.containsKey(f)){this._order.push(f)}return($super(f,g))}function d($super,f){var g=$super(f);this._order=this._order.findAll(function(h){return h!=f});return g}return{_each:c,_backingorder:b,initialize:a,set:e,unset:d}})();var LinkedHashMap=Class.create(HashMap,AbstractLinkedMapDecorator);LinkedHashMap.addMethods({inspect:function(){return"#<LinkedHashMap:{"+this.map(function(a){return a.map(Object.inspect).join(": ")}).join(", ")+"}>"}});var CaseInsensitiveLinkedHashMap=Class.create(CaseInsensitiveHashMap,AbstractLinkedMapDecorator);CaseInsensitiveLinkedHashMap.addMethods({inspect:function(){return"#<CaseInsensitiveLinkedHashMap:{"+this.map(function(a){return a.map(Object.inspect).join(": ")}).join(", ")+"}>"},unset:function($super,a){var b=$super(a);this._order=this._order.findAll(function(c){if(typeof a=="string"){return c!=a.toLowerCase()}return c!=a});return b}});var SortedMap=Class.create(HashMap,AbstractLinkedMapDecorator);SortedMap.addMethods({inspect:function(){return"#<SortedMap:{"+this.map(function(a){return a.map(Object.inspect).join(": ")}).join(", ")+"}>"},_backingorder:function(){return new SortedList(SapphireLib.StringComparator)}});var CaseInsensitiveSortedMap=Class.create(CaseInsensitiveHashMap,AbstractLinkedMapDecorator);CaseInsensitiveSortedMap.addMethods({inspect:function(){return"#<CaseInsensitiveSortedMap:{"+this.map(function(a){return a.map(Object.inspect).join(": ")}).join(", ")+"}>"},_backingorder:function(){return new SortedList(SapphireLib.CaseInsensitiveStringComparator)}});var HashSet=(function(){var a={};var b=Class.create(Enumerable,{initialize:function(c){this._object=this._backingobj();if(Object.isArray(c)){c.each(this.add,this)}},_backingobj:function(){return new LinkedHashMap()},size:function(){return this._object.size()},isEmpty:function(){return this._object.size()===0},clear:function(){this._object.clear()},add:function(c){this._object.set(c,a)},contains:function(c){return(this._object.get(c)===a)},include:function(c){return(this._object.get(c)===a)},remove:function(c){return(this._object.unset(c)===a)},values:function(){return this._object.keys()},inspect:function(){return"#<HashSet:"+this.toArray().inspect()+">"},_each:function(c){return this._object.keys().each(c)},clone:function(){return new HashSet(this._object.keys())},uniq:function(){return this._object.keys()}});b.placeholder=a;["compact","flatten","intersect","toJSON","reverse","without","concat"].each(function(c){if(!b.prototype[c]){b.prototype[c]=function(){return Array.prototype[c].apply(this._object.keys(),arguments)}}});return b})();var Set=HashSet;var CaseInsensitiveHashSet=Class.create(HashSet,{_backingobj:function(){return new CaseInsensitiveLinkedHashMap({})},inspect:function(){return"#<CaseInsensitiveHashSet:"+this.toArray().inspect()+">"}});SapphireLib.PreloadImages=(function(){var a={},c=new Element("div",{id:"__preloadedimgs"}).setStyle({position:"absolute",top:"-5000px",height:"10px",width:"10px",display:"inline"});function b(){$A(arguments).each(function(d){if(typeof d=="string"){if(a[d]){return}var e=new Element("img",{src:d});c.insert(e);a[d]=e}})}Event.addInitEvent(function(){$(document.body).insert({top:c})});return{add:b,images:a}})();var CFDump={collapse:function(a){$$("table."+a).each(function(b){cfdump_toggleTable(b.rows[0].cells[0])})}};function collapse_cfdump_tables(a){return CFDump.collapse(a)}Event.addInitEvent(function(){if(typeof dirtyCheck==="undefined"){dirtyCheck=function(){return true};window.dirtyCheck=dirtyCheck;document.dirtyCheck=dirtyCheck}});(function(){function a(b){new Ajax.Request(b,{method:"get",asynchronous:true,noloadingbox:true,parameters:"tme="+Math.random(),onSuccess:function(c,d){if(!c.status){}else{if(c.status==200&&d&&d===true){if(document.fire){document.fire("sapphire:sessionalive")}}else{if(!d){if(document.fire){document.fire("sapphire:sessiondead")}alert("Server session has timed out.  Please login again.")}}}},onFailure:function(c,d){alert("An error has occurred. Please try again.")}})}SapphireLib.pingGBK=function(){a("/Gradebook/PingAJAX.cfm")};SapphireLib.pingSIS=function(){a("/Gradebook/CMS/PingAJAX.cfm")};SapphireLib.pingSN=function(){a("/SchoolNurse/PingAJAX.cfm")};SapphireLib.pingIEP=function(){a("/Gradebook/CMS/IEPWriter/PingAJAX.cfm")}})();var __xx_set_visible={};function xx_position_tag(a,b,f){var d=$J("#"+b);var h={top:$J(window).scrollTop(),left:$J(window).scrollLeft()};if(!f.pageY){f.pageY=f.clientY+h.top;f.pageX=f.clientX+h.left}var c=d.parent().offsetParent().offset();var k={top:f.pageY+20,left:f.pageX+10};var i={width:d.outerWidth()+10,height:d.outerHeight()+10};var j={right:h.left+$J("body").width(),bottom:h.top+$J(window).height()};if(k.left+i.width>j.right){k.left=j.right-i.width}if(k.top+i.height>j.bottom){k.top=k.top-i.height-15}if(!c){c={top:0,left:0}}var g={top:k.top-c.top,left:k.left-c.left};d.css(g)}function xx_move_tag(b,a,c){}function xx_set_visible(c,a,d,b){var f=$J("#"+a);f.addClass("cfchart_tooltip");if(!__xx_set_visible[a]){f.css("visibility","visible");__xx_set_visible[a]=true}f[b?"show":"hide"]();xx_position_tag(c,a,d)}SapphireLib.HistoryManager=(function(){var f=[];var b=-1;var c={};var g=false;function l(o){o=o||location.hash;if(!o){return 0}o=(o.charAt(0)=="#"?o.substring(1):o);if(o){return Number(o)}return null}function h(o){Object.keys(o).each(function(p){if(Object.isFunction(c[p])){(c[p])(o[p])}})}function n(){h(k())}function m(){if(!g){$J(window).hashchange(n);f.push({});g=true}}function k(p){var o=l(location.hash);if(o>=f.length){o=f.length-1}if(o<0){return{}}if(p){return f[o][p]||{}}else{return f[o]}}function e(o){if(b==-1){return{}}if(o){return f[b][o]||{}}else{return f[b]}}function i(){if(b>-1){throw"Already in Transaction"}else{b=f.length;f[b]={}}}function a(){if(b==-1){return}if(g){window.location.hash=b}else{h(f[b])}b=-1}function j(q,o,s){var r=k(),p=false;r[q]=o;if(b==-1){i();p=true}f[b][q]=s;if(p){a()}}function d(o,p){c[o]=p;return{getCurrentState:k.curry(o),getNextState:e.curry(o),beginTransaction:i,commitTransaction:a,changeState:j.curry(o)}}return{init:m,getCurrentState:k,getNextState:e,beginTransaction:i,commitTransaction:a,changeState:j,registerPlugin:d}})();if(!window.console){window.console={log:function(){},warn:function(){},error:function(){},time:function(){},timeEnd:function(){}}}var AbstractDictionaryDecorator={getPairs:function(){return this.pairs()},getPairsByCode:function(){return this.sortBy(function(a){return a.key.toLowerCase()})},getPairsByDescription:function(){return this.sortBy(function(a){return a.value.toLowerCase()})},getOptions:function(){return this.map(function(a){return new Option(a.value,a.key)})},getOptionsByCode:function(){return this.getPairsByCode().map(function(a){return new Option(a[1],a[0])})},getOptionsByDescription:function(){return this.getPairsByDescription().map(function(a){return new Option(a[1],a[0])})},loadFromCFQuery:function(d,b,a){for(var c=0;c<d.RECORDCOUNT;c++){this.set(d.DATA[b][c],d.DATA[a][c])}return this}};var Dictionary=Class.create(CaseInsensitiveSortedMap,AbstractDictionaryDecorator);var OrderedDictionary=Class.create(CaseInsensitiveLinkedHashMap,AbstractDictionaryDecorator);SapphireLib.FormLib=(function(){var f={};var p=Array.prototype.slice;var b={};var g={};var i=Class.create({initialize:function(s,r,q){if(typeof r=="function"){this.options=$H(q);this._handler=r}else{this.options=$H(r);this._handler=function(t,u){return t}}this.className=s},transform:function(q,s){var r=q;if(s.type=="select"){return}if(s.type=="select-one"){return}this.options.each(function(t){if(SapphireLib.FormLib.DataTransformer.methods[t.key]){r=(SapphireLib.FormLib.DataTransformer.methods[t.key])(r,s,t.value)}});r=this._handler(r,s);if(q!==r){s.setValue(r);s.fireNative("change")}}});var j=Class.create({initialize:function(r,s){this.options=Object.extend({onSubmit:true,immediate:true,dblClickDefaults:true,focusOnError:false,adviceImgOnly:true,useTitles:false,stopOnFirst:false,trackDirty:false,trackChanges:true,onFormValidate:function(u,v){},onElementValidate:function(u,v){}},s||{});this.form=$(r);this.validator=new Validation(r,{adviceImgOnly:this.options.adviceImgOnly,onSubmit:false,immediate:false,onFormValidate:this.onFormValidate.bind(this),onElementValidate:this.onElementValidate.bind(this)});this.form.SmartFormIsDirty=false;this.form.SmartFormDirtyAck=false;this.form.smartsubmit=this.smartsubmit.bind(this);this.form.smartexecute=this.smartexecute.bind(this);this.form.validate=this.validate.bind(this);this.originalValues=this.form.serialize({hash:true});this.currentValues=this.form.serialize({hash:true});this.changeLog=[];this.redoLog=[];this.onSubmitListener=this.onSubmit.bindAsEventListener(this);this.onBlurListener=this.onBlur.bindAsEventListener(this);this.onDoubleClickListener=this.onDoubleClick.bindAsEventListener(this);this.onChangeListener=this.onChange.bindAsEventListener(this);this.onUnloadListener=this.onUnload.bindAsEventListener(this);this.onElementsAddedListener=this.onElementsAdded.bindAsEventListener(this);this.onBeforeUnloadListener=this.onUnload.bind(this);this.formValidateObservers=[];this.elementValidateObservers=[];if(this.options.onFormValidate&&typeof this.options.onFormValidate=="function"){this.formValidateObservers.push(this.options.onFormValidate)}if(this.options.onElementValidate&&typeof this.options.onElementValidate=="function"){this.elementValidateObservers.push(this.options.onElementValidate)}if(this.options.onSubmit){this.form.observe("submit",this.onSubmitListener)}this.form.observe("dblclick",this.onDoubleClickListener);if(this.options.trackDirty||this.options.trackChanges){this.form.observe("smartform:changed",this.onChangeListener);if(Event.canDelegate("change")){this.form.observe("change",this.onChangeListener)}else{var q=this.onChangeListener;Form.getElements(this.form).each(function(u){Event.observe(u,"change",q);u.smartformChangeListening=true})}}if(this.options.trackDirty){Event.addBeforeUnloadHandler(this.onBeforeUnloadListener);Event.observe(document,"smartform:wantleave",this.onUnloadListener)}if(this.options.immediate){var t=this.onBlurListener;Form.getElements(this.form).each(function(u){Event.observe(u,"blur",t);u.smartformBlurListening=true})}if(Form.getElements(this.form).any(function(u){return Element.hasClassName(u,"smartform:isdirty")})){this.form.SmartFormIsDirty=true}this.form.observe("validation:validatethis",this.onBlurListener);this.form.observe("sapphire:elementsadded",this.onElementsAddedListener)},onElementsAdded:function(r){if(this.options.trackDirty||this.options.trackChanges){if(!Event.canDelegate("change")){var q=this.onChangeListener;Form.getElements(r.element()).each(function(t){if(!t.smartformChangeListening){Event.observe(t,"change",q);t.smartformChangeListening=true}})}}if(this.options.immediate){var s=this.onBlurListener;Form.getElements(r.element()).each(function(t){if(!t.smartformBlurListening){Event.observe(t,"blur",s);t.smartformBlurListening=true}})}},destroy:function(){this.form.smartsubmit=null;this.form.smartexecute=null;this.form.stopObserving("validation:validatethis",this.onBlurListener);if(this.options.onSubmit){this.form.stopObserving("submit",this.onSubmitListener)}this.form.stopObserving("dblclick",this.onDoubleClickListener);if(this.options.trackDirty||this.options.trackChanges){if(Event.canDelegate("change")){this.form.stopObserving("change",this.onChangeListener)}else{var q=this.onChangeListener;Form.getElements(this.form).each(function(s){Event.stopObserving(s,"change",q)})}}if(this.options.trackDirty){Event.removeBeforeUnloadHandler(this.onBeforeUnloadListener);Event.stopObserving(document,"smartform:wantleave",this.onUnloadListener)}if(this.options.immediate){var r=this.onBlurListener;Form.getElements(this.form).each(function(s){Event.stopObserving(s,"blur",r)})}},onFormValidate:function(q,r){this.formValidateObservers.each(function(s){s(q,r)})},onElementValidate:function(q,r){this.elementValidateObservers.each(function(s){s(q,r)})},onUnload:function(r,q){if(r.type=="beforeunload"){if(!this.form.SmartFormIsDirty){return}if(this.form.SmartFormDirtyAck){return}if(q){if(q.hasClassName("ignoredirty")||!!q.up(".ignoredirty")){return}}return"If you navigate away from this page, you will lose any unsaved data."}if(!this.form.SmartFormIsDirty){r.returnValue=true;return true}if(this.form.SmartFormDirtyAck){r.returnValue=true;return true}if(confirm("If you navigate away from this page, you will lose any unsaved data.  Are you sure?")){this.form.SmartFormDirtyAck=true;r.returnValue=true;return true}else{r.stop();r.returnValue=false;return false}},dirtyWarning:function(){if(!this.form.SmartFormIsDirty){return true}if(this.form.SmartFormDirtyAck){return true}return(this.form.SmartFormDirtyAck=confirm("Are you sure you want to leave this page?  All unsaved changes will be lost."))},onChange:function(t){var r=t.element();if(this.options.trackDirty&&!r.hasClassName("dirtyexempt")){if(!this.form.SmartFormIsDirty){this.form.SmartFormIsDirty=true;this.form.fire("smartform:dirty")}else{}if(this.form.SmartFormDirtyAck){this.form.SmartFormDirtyAck=false}}if(this.options.trackChanges&&r.name&&r!==this.form){var s=this.currentValues[r.name];var q=$F(r);if(!s){s=(this.currentValues[r.name]="")}if(s!==q){this.changeLog.push([r,r.name,s,q]);this.redoLog=[];this.currentValues[r.name]=q}}},undoLast:function(){var q=this.changeLog.pop();if(q){var r=q[0];this.currentValues[q[1]]=q[2];r.setValue(q[2]===null?"":q[2]);this.redoLog.push(q);r.fireNative("change");if(this.options.immediate){this.validator.validateElement(r)}}},redoLast:function(){var q=this.redoLog.pop();if(q){var r=q[0];this.currentValues[q[1]]=q[3];r.setValue(q[3]===null?"":q[3]);this.changeLog.push(q);r.fireNative("change");if(this.options.immediate){this.validator.validateElement(r)}}},getFormChanges:function(){var r=this.form.serialize({hash:true});var q={};for(var s in r){if(r.hasOwnProperty(s)){if(!this.originalValues.hasOwnProperty(s)||this.originalValues[s]!==r[s]){q[s]=r[s]}}}return q},smartsubmit:function(q){Form.getElements(this.form).collect(this.transformElement);if(this.validator.validate()){if(q){this.form.SmartFormDirtyAck=true}this.form.submit()}else{alert("Please fix the indicated errors.")}},smartexecute:function(r,q){Form.getElements(this.form).collect(this.transformElement);if(this.validator.validate()){if(q){this.form.SmartFormDirtyAck=true}if(r){r(this.form)}}else{alert("Please fix the indicated errors.")}},onSubmit:function(q){Form.getElements(this.form).collect(this.transformElement);this.validator.onSubmitListener(q)},onBlur:function(q){this.transformElement(q.element());this.validator.onBlurListener(q)},onDoubleClick:function(s){var r=$(s.element());if(!!r.disabled){return}if(!!r.readOnly){return}for(var q in b){if(r.hasClassName(q)){(b[q])(r);r.fireNative("change");return}}},observeFormValidate:function(q){if(typeof q=="function"){this.formValidateObservers.push(q)}},observeElementValidate:function(q){if(typeof q=="function"){this.elementValidateObservers.push(q)}},transformElement:function(r,q){var t=$(r);var s=t.classNames();s.each(function(u){if(g[u]){g[u].transform($F(t),t)}})},validateElement:function(q){this.transformElement(q);return this.validator.validateElement(q)},getInvalidElements:function(q){return Form.getElements(this.form).select(function(r){return !this.validateElement(r)},this)},validate:function(){Form.getElements(this.form).collect(this.transformElement);return this.validator.validate()}});function n(r,q){var t=$(r);var s=t.classNames();s.each(function(u){if(g[u]){g[u].transform($F(t),t)}})}function k(s){var r=$(s);var q=r.identify();if(f[q]){return f[q]}return(f[q]=new j(r,p.call(arguments,1)))}function o(t){var r=$(t);var q=r.identify();if(f[q]){var s=f[q];s.destroy();s=null;delete f[q]}}function e(u,t){var s=$(u);var q=s.identify();if(f[q]){return f[q]}var r=t||{};if(s.hasClassName("smartform:img")){r.adviceImgOnly=true}if(s.hasClassName("smartform:div")){r.adviceImgOnly=false}if(s.hasClassName("smartform:blur")){r.immediate=true}if(s.hasClassName("smartform:noblur")){r.immediate=false}if(s.hasClassName("smartform:submit")){r.onSubmit=true}if(s.hasClassName("smartform:nosubmit")){r.onSubmit=false}if(s.hasClassName("smartform:dblclick")){r.dblClickDefaults=true}if(s.hasClassName("smartform:nodblclick")){r.dblClickDefaults=false}if(s.hasClassName("smartform:focuserror")){r.focusOnError=true}if(s.hasClassName("smartform:nofocuserror")){r.focusOnError=false}if(s.hasClassName("smartform:stoponfirst")){r.stopOnFirst=true}if(s.hasClassName("smartform:nostoponfirst")){r.stopOnFirst=false}if(s.hasClassName("smartform:usetitles")){r.useTitles=true}if(s.hasClassName("smartform:nousetitles")){r.useTitles=false}if(s.hasClassName("smartform:trackdirty")){r.trackDirty=true}if(s.hasClassName("smartform:notrackdirty")){r.trackDirty=false}if(s.hasClassName("smartform:trackchanges")){r.trackChanges=true}if(s.hasClassName("smartform:notrackchanges")){r.trackChanges=false}return(f[q]=new j(s,r))}function d(s){var r=$(s);var q=r.identify();if(f[q]){return f[q]}return null}function l(){return $H(f).keys()}function m(r,q){b[r]=q}function h(q){Object.extend(b,q||{})}function c(t,s,r){var q={};q[t]=new i(t,s,r);Object.extend(g,q)}function a(r){var q={};$A(r).each(function(s){q[s[0]]=new i(s[0],s[1],(s.length>2?s[2]:{}))});Object.extend(g,q)}return{DataTransformer:i,Validator:Validator,Validation:Validation,attach:k,detach:o,destroy:o,get:d,transformElement:n,attachByClass:e,listForms:l,addDoubleClickDefault:m,addTheseDoubleClickDefaults:h,addTransform:c,addAllTheseTransforms:a}})();SapphireLib.FormLib.DataTransformer.methods={ltrim:(function(){var a=new RegExp("^\\s+","g");return function(b,d,c){return b.replace(a,"")}})(),rtrim:(function(){var a=new RegExp("\\s+$","g");return function(b,d,c){return b.replace(a,"")}})(),trim:(function(){var a=new RegExp("^\\s+|\\s+$","g");return function(b,d,c){return b.replace(a,"")}})(),nospaces:(function(){var a=new RegExp("\\s*","g");return function(b,d,c){return b.replace(a,"")}})(),nocommas:(function(){var a=new RegExp(",*","g");return function(b,d,c){return b.replace(a,"")}})(),nodots:(function(){var a=new RegExp("\\.","g");return function(b,d,c){return b.replace(a,"")}})(),noquotes:(function(){var a=new RegExp("['\"]*","g");return function(b,d,c){return b.replace(a,"")}})(),nodoublequotes:(function(){var a=new RegExp('"*',"g");return function(b,d,c){return b.replace(a,"")}})(),nosinglequotes:(function(){var a=new RegExp("'*","g");return function(b,d,c){return b.replace(a,"")}})(),nohtml:(function(){var a=new RegExp("<[^>]*>","g");return function(b,d,c){return b.replace(a,"")}})(),alphanumericonly:(function(){var a=new RegExp("[^\\w]*","g");return function(b,d,c){return b.replace(a,"")}})(),digitsonly:(function(){var a=new RegExp("[^\\d]*","g");return function(b,d,c){return b.replace(a,"")}})(),lettersonly:(function(){var a=new RegExp("[^A-Za-z]*","g");return function(b,d,c){return b.replace(a,"")}})(),commastodots:(function(){var a=new RegExp(",","g");return function(b,d,c){return b.replace(a,".")}})(),dotstocommas:(function(){var a=new RegExp("\\.","g");return function(b,d,c){return b.replace(a,",")}})(),digitscommas:(function(){var a=new RegExp("[^\\d,]*","g");return function(b,d,c){return b.replace(a,"")}})(),digitsdots:(function(){var a=new RegExp("[^\\d\\.]*","g");return function(b,d,c){return b.replace(a,"")}})(),lcase:function(a,c,b){return a.toLowerCase()},ucase:function(a,c,b){return a.toUpperCase()},regexp:function(a,c,b){return a.replace(b.regexp,b.value||"")},wordconvert:(function(){var a=[new RegExp(String.fromCharCode(710),"g"),"^",new RegExp(String.fromCharCode(732),"g"),"~",new RegExp(String.fromCharCode(8216),"g"),"'",new RegExp(String.fromCharCode(8217),"g"),"'",new RegExp(String.fromCharCode(8220),"g"),'"',new RegExp(String.fromCharCode(8221),"g"),'"',new RegExp(String.fromCharCode(8211),"g"),"-",new RegExp(String.fromCharCode(8212),"g"),"--",new RegExp(String.fromCharCode(8218),"g"),",",new RegExp(String.fromCharCode(8222),"g"),",,",new RegExp(String.fromCharCode(8226),"g"),"*",new RegExp(String.fromCharCode(8230),"g"),"...",new RegExp(String.fromCharCode(8364),"g"),"",new RegExp(String.fromCharCode(61550),"g"),""];return function(b,e,d){var c=(a.length-2)&254;while(c>0){b=b.replace(a[c],a[c+1]);c-=2}return b}})()};SapphireLib.FormLib.Validation.addAllThese([["validate-code","Please use only letters (a-z), numbers (0-9), underscores, dashes, pluses and dots in this field. No spaces or other characters are allowed.",function(a){return Validator.methods.isEmpty(a)||/^[A-Za-z0-9_\.\+\-]+$/.test(a)}],["validate-codelist","Please use only letters (a-z), numbers (0-9), underscores, dashes, pluses and dots in this field. No spaces or other characters are allowed in each item, but no empty items allowed in the list.",function(a){return Validator.methods.isEmpty(a)||/^[A-Za-z0-9_\.\+\-]+(,[A-Za-z0-9_\.\+\-]+)*$/.test(a)}],["validate-strictcode","Please use only letters (a-z), numbers (0-9) or underscores in this field. No spaces or other characters are allowed.",function(a){return Validator.methods.isEmpty(a)||/^[A-Za-z0-9_]+$/.test(a)}],["validate-digitlist","Please use only numbers (0-9) and commas.  No spaces or other characters are allowed and no empty items are allowed in the list.",function(a){return Validator.methods.isEmpty(a)||/^[0-9]+(,[0-9]+)*$/.test(a)}],["validate-numeric","Please enter a valid number.",{include:["validate-number"]}],["validate-alphanumeric","Please enter a valid alpha-numeric value.",{include:["validate-alphanum"]}],["required-warning","This may be a required field.",function(a){if(Validator.methods.isEmpty(a)){return new Validator.Warning("This may be a required field.")}return true}]]);SapphireLib.FormLib.addAllTheseTransforms([["validate-email",{trim:true}],["validate-url",{trim:true}],["date_picker",{trim:true}],["date_picker16",{trim:true}],["date_picker24",{trim:true}],["trimfield",{trim:true}],["wordprotect",{wordconvert:true}],["makeucase",{ucase:true}],["makelcase",{lcase:true}],["removespaces",{nospaces:true}],["removecommas",{nocommas:true}],["validate-code",{nospaces:true,noquotes:true,commastodots:true,trim:true}],["validate-strictcode",{nospaces:true,noquotes:true,trim:true}],["validate-codelist",{nospaces:true,noquotes:true,trim:true}],["validate-digitlist",{nospaces:true,noquotes:true,trim:true}],["removequotes",{noquotes:true}],["removetags",{nohtml:true}]]);Behavior.register({"form.smartform":{run:SapphireLib.FormLib.attachByClass}});SapphireLib.FormLib.Validation.addAllThese([["validate-schooldate","Please enter a valid date.",{include:["validate-date"]}],["validate-time","Please enter a valid time.",function(a){var b=new Date("1/1/1970 "+a);return Validator.methods.isEmpty(a)||!isNaN(b)}],["validate-schooltime","Please enter a school valid time.",function(a){var b=new Date("1/1/1970 "+a);if(Validator.methods.isEmpty(a)){return true}if(isNaN(b)){return false}if(b<new Date("1/1/1970 06:00")){return new Validator.Warning("Warning: Time  ("+a+") is before 6am... Times should be entered in 24hr format.")}if(b>new Date("1/1/1970 18:00")){return new Validator.Warning("Warning: Time ("+a+") is after 6pm.")}return true}]]);(function(){function d(f,i){if(Validator.methods.isEmpty(f)){return f}var h=new Date("1/1/1970 "+f);if(isNaN(h)){var g="";if(f.length==3){g=f.substring(0,1)+":"+f.substring(1,3)}else{if(f.length==2){g=new Date().strftime("%H:")+f}else{g=f.substring(0,2)+":"+f.substring(2,4)}}h=new Date("1/1/1970 "+g)}if(isNaN(h)){return f}return h.strftime("%H:%M")}var e=new RegExp("^\\s*(\\d*)/(\\d*)/?(\\d*)\\s*$");function b(p,k,s){var r=null,l=null,f=null,n=null,h=false,g=new Date(),q=0,o=false;o=!!o;k.sapphireBadValue=false;if(Validator.methods.isEmpty(p)){return p}r=p.match(e);if(r===null||typeof r==="undefined"||!r){k.sapphireBadValue=true;return p}if(!r[1]||r[1].length===0){k.sapphireBadValue=true;return p}if(!r[2]||r[2].length===0){k.sapphireBadValue=true;return p}l=Number(r[1]);n=Number(r[2]);if(isNaN(l)){k.sapphireBadValue=true;return p}if(1>l||l>12){k.sapphireBadValue=true;return p}if(isNaN(n)){k.sapphireBadValue=true;return p}if(1>n||n>31){k.sapphireBadValue=true;return p}if(!r[3]||r[3].length===0){f=g.getFullYear();if(o){var j=f;if(g.getMonth()<8||(g.getMonth()==8&&g.getDay()<20)){j--}if(l<8||(l==8&&n<20)){f=j+1}else{f=j}}}else{f=Number(r[3])}if(isNaN(f)){k.sapphireBadValue=true;return p}if(f<70){f+=2000}if(f<100){f+=1900}if(f<1753){k.sapphireBadValue=true;return p}if(f>2100){k.sapphireBadValue=true;return p}var i=new Date(f,l-1,n);if(isNaN(i)){k.sapphireBadValue=true;return p}var m=new Date();m.setTime(i.getTime());if(m.getFullYear()!==f||m.getMonth()!==l-1||m.getDate()!==n){k.sapphireBadValue=true;return p}k.sapphireBadValue=false;return i.strftime("%m/%d/%Y")}function c(f,g){return b(f,g,false)}function a(f,g){return b(f,g,true)}SapphireLib.FormLib.addAllTheseTransforms([["validate-date",c,{nospaces:true}],["validate-schooldate",a,{nospaces:true}],["validate-time",d,{nospaces:true}],["validate-schooltime",d,{nospaces:true}]])})();SapphireLib.FormLib.addTheseDoubleClickDefaults({"validate-date":function(a){a.setValue(new Date().strftime("%m/%d/%Y"))},"validate-schooldate":function(a){a.setValue(new Date().strftime("%m/%d/%Y"))},"validate-time":function(a){a.setValue(new Date().strftime("%H:%M"))},"validate-schooltime":function(a){a.setValue(new Date().strftime("%H:%M"))}});(function(){var h=(Prototype.Browser.IE&&Prototype.X.Browser.IE<7);function b(i){i._TypebackBuffer=""}function g(i){i._TypebackBuffer="";if(i.form.TYPEBACKDEBUG){i.form.TYPEBACKDEBUG.value=i._TypebackBuffer}}function c(j,i){j._TypebackBuffer+=unescape("%"+i.toString(16));if(j.form.TYPEBACKDEBUG){j.form.TYPEBACKDEBUG.value=j._TypebackBuffer}}function d(i){g(i.element());return true}function f(i){var l=i.element(),k=i.getKeyCode(),j=i.getKeyModifiers();if(l.form.KEYDEBUG){l.form.KEYDEBUG.value+="keycode "+k+" modifiers "+j+"\r\n"}}function a(s){var n=s.element(),t=s.getKeyCode(),q=s.getKeyModifiers(),p=0,r=n.options.length-1;if(q!==0&&q!==4){return true}if(t!=Event.KEY_ESC&&t!=Event.KEY_BACKSPACE&&t!=32&&!(t>=65&&t<=90)&&!(t>=97&&t<=122)){return true}if(!n._TypebackBuffer){b(n)}if(t==Event.KEY_ESC||t==Event.KEY_BACKSPACE){g(n);return false}c(n,t);s.stop();if(n.options[p].text===""){p++}if(n.options[p].text.toUpperCase()==="OTHER"){p++}for(var o=0;o<n._TypebackBuffer.length;o++){var k=n._TypebackBuffer.charAt(o).toUpperCase();var u=false;for(var m=p;m<=r;m++){var l=n.options[m].text.charAt(o).toUpperCase();if(l<k){p=m}if(!u&&l==k){p=m;u=true}if(l>k){r=m-1;break}}if(!u){break}}if(n.form.FIRSTDEBUG){n.form.FIRSTDEBUG.value=p}if(n.form.LASTDEBUG){n.form.LASTDEBUG.value=r}if(p<n.options.length){n.selectedIndex=p;Event.fireNative(n,"change")}return false}function e(){if(!h){return true}if(typeof Behavior!="undefined"){Behavior.register({"select.smart_dropdown":{focus:SapphireLib.SmartDropDown.clearBufferEvt,blur:SapphireLib.SmartDropDown.clearBufferEvt,keydown:SapphireLib.SmartDropDown.keydownEvt}})}}Object.extend(SapphireLib,{SmartDropDown:{browserStupid:h,clearBufferEvt:d,keydownEvt:a,debugKeydownEvt:f}});e()})();var SapphireControls=SapphireControls||{};SapphireControls.LoadingBox=function(){var d=Prototype.Browser.IE&&Prototype.X.Browser.IE<7;SapphireLib.PreloadImages.add(SapphireLib.SapphirePrefix+"/window_themes/alert/progress.gif");function a(h,g){this.options=Object.extend({showImg:true,imgUrl:SapphireLib.SapphirePrefix+"/window_themes/alert/progress.gif",className:"loading_msg",parentElement:null,topOffset:0,rightOffset:0},g||{});this.element=null;this.active=false;this.ourEvtListener=c.bindAsEventListener(this);this.message=h||"Loading...";if(this.options.id){this.element=$(this.options.id)}}function c(){if(d&&this.active&&this.element){var g=document.viewport.getScrollOffsets();if(!this.lastOffsets){this.lastOffsets=g;this.offsetFix=0}if(g.top==this.lastOffsets.top){this.offsetFix=(this.offsetFix+1)%2}this.element.setStyle({marginTop:(-this.offsetFix)+"px",top:(g.top+this.options.topOffset+this.offsetFix)+"px",right:this.options.rightOffset+"px"});this.lastOffsets=g}}function e(){var g=new Element("div",{className:this.options.className}).update(this.message);g.setStyle({top:this.options.topOffset+"px",right:this.options.rightOffset+"px",display:"none"});if(d){g.setStyle({position:"absolute"})}if(this.options.id){g.id=this.options.id}if(this.options.zIndex){g.style.zIndex=this.options.zIndex}if(this.options.showImg){g.insert({bottom:new Element("img",{src:this.options.imgUrl,alt:""}).setStyle({marginLeft:"5px"})})}return g}function b(){if(!this.element){this.element=(e.bind(this))()}if(!this.active){var g=(this.options.parentElement)||document.body;g.insert({top:this.element});this.active=true}if(d){this.setPosition();Event.observe(window,"resize",this.ourEvtListener);Event.observe(window,"scroll",this.ourEvtListener)}this.element.show()}function f(){if(this.active){this.element.hide();this.active=false;if(d){Event.stopObserving(window,"resize",this.ourEvtListener);Event.stopObserving(window,"scroll",this.ourEvtListener)}this.element.remove()}}return Class.create({initialize:a,show:b,hide:f,setPosition:c})}();SapphireControls.DatePicker=Class.create(CalendarDateSelect,{});Object.extend(SapphireControls.DatePicker,function(){var b={};function d(j,i){var g=$(j);var h=Object.extend(b[g.id]||{},i||{});g.classNames().each(function(l){var k=null;if((k=l.match(/^dp:yearrange:([0-9]*):([0-9]*)$/))){h.year_range=[Number(k[1]),Number(k[2])]}else{if((k=l.match(/^dp:yearrange:([0-9]*)$/))){h.year_range=Number(k[1])}else{if((k=l.match(/^dp_embedded$/))){h.embedded=true}}}});new SapphireControls.DatePicker(g,h)}function e(j,i){var g=$(j);var h=g.identify();g.insert({after:new SapphireControls.Icon({id:h+"-datepicker",title:"Date Picker",alt:"Date Picker",baseImage:SapphireLib.SapphirePrefix+"/images/icons/calendar24_h.gif",hoverImage:SapphireLib.SapphirePrefix+"/images/icons/calendar24.gif",disabledImage:SapphireLib.SapphirePrefix+"/images/icons/calendar24_d.gif",disabled:false,onactivate:function(){if(!!g.disabled||!!g.readOnly){alert("Sorry, this field is read only.");return}new SapphireControls.DatePicker(g,i)}})})}function a(k,j){var g=$(k);var h=g.identify();var i=SapphireLib.SapphirePrefix+"/images/icons/calendar"+(g.hasClassName("date_picker16")?"16":"24");if($(h+"-datepicker")){$(h+"-datepicker").remove()}g.insert({after:new SapphireControls.Icon({id:h+"-datepicker",title:"Date Picker",alt:"Date Picker",baseImage:i+"_h.gif",hoverImage:i+".gif",disabledImage:i+"_d.gif",disabled:false,onactivate:function(){if(!!g.disabled||!!g.readOnly){alert("Sorry, this field is read only.");return}d(g,j||{})}})})}function f(h,g,i){var j=$(h).identify();if(!b[j]){b[j]={}}b[j][g]=i}function c(h,g){var i=$(h).identify();if(!b[i]){b[i]={}}Object.extend(b[i],g)}return{add:e,addByClass:a,setDpOption:c,setDpOptions:c}}());Behavior.register({"input.date_picker":{run:SapphireControls.DatePicker.addByClass},"input.date_picker16":{run:SapphireControls.DatePicker.addByClass},"input.date_picker24":{run:SapphireControls.DatePicker.addByClass}});SapphireControls.Icon=(function(){function f(j){var k={imgOnly:false,baseClass:"toolbar_btn",hoverClass:"toolbar_btn_hover",activeClass:"toolbar_btn_active",disabledClass:"toolbar_btn",baseImage:"",developer:false,alt:"",title:"",id:"",disabled:false};Object.extend(k,j||{});k.hoverImage=k.hoverImage||k.baseImage;k.activeImage=k.activeImage||k.baseImage;k.disabledImage=k.disabledImage||k.baseImage;return k}function a(j){if(!this.disabled){this.src=this._iconOptions.hoverImage;this.className=this._iconOptions.hoverClass;this.fire("icon:hover")}}function h(j){this.src=this.disabled?this._iconOptions.disabledImage:this._iconOptions.baseImage;this.className=this.disabled?this._iconOptions.disabledClass:this._iconOptions.baseClass;this.fire("icon:stophover")}function i(j){this.blur()}function c(j){if(!this.disabled){this.src=this._iconOptions.activeImage;this.className=this._iconOptions.activeClass}}function d(j){if(!this.disabled){this.fire("icon:activate")}(i.bind(this))(j);if(j){j.stop()}if(typeof event!=="undefined"){Event.stop(event)}return false}function g(){this.disabled=true;(h.bind(this))()}function b(){this.disabled=false;(h.bind(this))()}function e(l){var n=f(l),k=!n.disabled,j={src:k?n.baseImage:n.disabledImage,className:k?n.baseClass:n.disabledClass,alt:n.alt,title:n.title},m="";if(n.id.length){Object.extend(j,{id:n.id})}if(!n.imgOnly){Object.extend(j,{type:"image"})}m=new Element(n.imgOnly?"img":"input",j);m._iconOptions=n;m.disabled=!k;m.observe("mouseover",a.bindAsEventListener(m));m.observe("mouseout",h.bindAsEventListener(m));m.observe("mouseup",i.bindAsEventListener(m));m.observe("mousedown",c.bindAsEventListener(m));m.observe("click",d.bindAsEventListener(m));SapphireLib.PreloadImages.add(n.baseImage,n.hoverImage,n.activeImage,n.disabledImage);if(n.onactivate){Event.observe(m,"icon:activate",n.onactivate.bindAsEventListener(m))}if(n.onhover){Event.observe(m,"icon:hover",n.onhover.bindAsEventListener(m))}if(n.onstophover){Event.observe(m,"icon:stophover",n.onstophover.bindAsEventListener(m))}m.setIconDisabled=g.bind(m);m.setIconEnabled=b.bind(m);return m}return e})();SapphireControls.ToggleIcon=(function(){function h(n){return Object.extend({imgOnly:false,baseClass:"toolbar_btn",hoverClass:"toolbar_btn_hover",activeClass:"toolbar_btn_active",disabledClass:"toolbar_btn",sticky:false,startState:0,states:[],baseImage:"",id:"",disabled:false},n||{})}function j(n,o,p){if(!n||n.length<2){alert("ToggleIcon must have at least 2 states");return[]}if(o.startState>=n.length){o.startState=0}if(n.length>2){o.sticky=false}return n.map(function(r,q){var s=Object.extend({baseImage:"",alt:"",title:"",idx:0,advanceStateOnActivation:true,onhover:Prototype.emptyFunction,onstophover:Prototype.emptyFunction,onactivate:Prototype.emptyFunction},r);s.idx=q;if(typeof s.nextIdx==="undefined"){s.nextIdx=((s.idx+1)%n.length)}s.baseClass=((!o.sticky||(q%2)===0)?o.baseClass:o.activeClass);s.hoverClass=((!o.sticky||(q%2)===0)?o.hoverClass:o.activeClass);s.activeClass=((!o.sticky||(q%2)===0)?o.activeClass:o.hoverClass);s.disabledClass=o.disabledClass;s.hoverImage=s.hoverImage||s.baseImage;s.activeImage=s.activeImage||s.baseImage;s.disabledImage=s.disabledImage||s.baseImage;s.onhover=s.onhover.bind(p);s.onstophover=s.onstophover.bind(p);s.onactivate=s.onactivate.bind(p);return s})}function b(n){if(!this.disabled){this.src=this._toggleIconState.hoverImage;this.className=this._toggleIconState.hoverClass;this.fire("toggleicon:hover")}}function k(n){this.src=this.disabled?this._toggleIconState.disabledImage:this._toggleIconState.baseImage;this.className=this.disabled?this._toggleIconState.disabledClass:this._toggleIconState.baseClass;this.fire("toggleicon:stophover")}function l(n){this.blur()}function c(n){if(!this.disabled){this.src=this._toggleIconState.activeImage;this.className=this._toggleIconState.activeClass}}function d(n){if(!this.disabled){(m.bind(this))(true);if(!this._toggleIconOptions.sticky){(c.bind(this))(n)}this.fire("toggleicon:activate")}(l.bind(this))(n);if(n){n.stop()}if(typeof event!=="undefined"){Event.stop(event)}return false}function i(){this.disabled=true;(g.bind(this))()}function a(){this.disabled=false;(g.bind(this))()}function g(n){if(typeof n!="undefined"&&(n<this._toggleIconStates.length)){this._toggleIconStateIdx=n;this._toggleIconState=this._toggleIconStates[n]}this.src=this.disabled?this._toggleIconState.disabledImage:this._toggleIconState.baseImage;this.className=this.disabled?this._toggleIconState.disabledClass:this._toggleIconState.baseClass;this.alt=this._toggleIconState.alt;this.title=this._toggleIconState.title}function f(p,o){var n=(this._toggleIconState.idx!=p);if(o&&n){this.fire("toggleicon:exitstate",this._toggleIconState.idx)}(g.bind(this))(p);if(o&&n){this.fire("toggleicon:enterstate",this._toggleIconState.idx)}}function m(n){if(this._toggleIconState.advanceStateOnActivation){(f.bind(this))(this._toggleIconState.nextIdx,n)}}function e(n,s){var r=h(n),p=!r.disabled,o=null,q=null;if(r.imgOnly){q=new Element("img")}else{q=new Element("input",{type:"image"})}o=j(s,r,q);if(r.id.length){q.id=r.id}q._toggleIconOptions=r;q._toggleIconStates=o;q._toggleIconState=null;q.disabled=!p;q.observe("mouseover",b.bindAsEventListener(q));q.observe("mouseout",k.bindAsEventListener(q));q.observe("mouseup",l.bindAsEventListener(q));q.observe("mousedown",c.bindAsEventListener(q));q.observe("click",d.bindAsEventListener(q));q.observe("toggleicon:hover",function(t){this._toggleIconState.onhover(t)}.bindAsEventListener(q));q.observe("toggleicon:stophover",function(t){this._toggleIconState.onstophover(t)}.bindAsEventListener(q));q.observe("toggleicon:exitstate",function(t){this._toggleIconState.onactivate(t)}.bindAsEventListener(q));if(r.onactivate){q.observe("toggleicon:activate",r.onactivate.bindAsEventListener(q))}o.each(function(t){SapphireLib.PreloadImages.add(t.baseImage,t.hoverImage,t.activeImage,t.disabledImage)});q.setToggleIconDisabled=i.bind(q);q.setToggleIconEnabled=a.bind(q);q.doToggleIconState=m.bind(q);q.setToggleIconState=f.bind(q);(g.bind(q))(r.startState);return q}return e})();SapphireLib=SapphireLib||{};SapphireLib.SmartCheckboxes=(function(){function a(c){while(c.tagName!="BODY"){if((!$(c).visible()||$(c).style.visibility=="hidden")){return false}c=c.parentNode}return true}var b=Class.create({initialize:function(c,d){this.container=$(c);this.className=d;this.lastClick=null;if(!this.container.SmartChecks){this.container.SmartChecks=[]}this.container.SmartChecks.push(this);this.onClickListener=this.onClick.bindAsEventListener(this);this.container.observe("click",this.onClickListener)},onClick:function(c){var j=c.element();if(!j.hasClassName(this.className)){return}if(this.lastClick!==null&&this.lastClick!==j&&c.shiftKey){var g=this.lastClick.up("tr").rowIndex,d=j.up("tr").rowIndex;if(g>d){var f=d;d=g;g=f}var h=function(i){var k=i.checked;i.checked=j.checked;if(k!=i.checked&&i.onclick){i.onclick()}};for(var e=g;e<=d;e++){this.lastClick.up("table").rows.item(e).select("input."+this.className).select(a).each(h)}}this.lastClick=j},destroy:function(){this.container.stopObserving("click",this.onClickListener);this.container.SmartChecks=this.container.SmartChecks.select(function(c){return c!==this})}});return b})();SapphireLib.SmartCheckboxesRow=(function(){function a(c){while(c.tagName!="BODY"){if((!$(c).visible()||$(c).style.visibility=="hidden")){return false}c=c.parentNode}return true}var b=Class.create({initialize:function(e,d,c){this.click_listener=$(e);this.containElemType=d;this.className=c;this.lastClick=null;if(!this.click_listener.SmartChecks){this.click_listener.SmartChecks=[]}this.click_listener.SmartChecks.push(this);this.onClickListener=this.onClick.bindAsEventListener(this);this.click_listener.observe("click",this.onClickListener)},onClick:function(c){var k=c.element();if(!k.hasClassName(this.className)){return}if(this.lastClick!==null&&this.lastClick!==k&&c.shiftKey){var g=k.up(this.containElemType).select("input."+this.className);var h=-1,d=-1;var j=function(i){var l=i.checked;i.checked=k.checked;if(l!=i.checked&&i.onclick){i.onclick()}};var e=false;for(var f=0;f<g.length;f++){if(!e&&(g[f]===this.lastClick||g[f]===k)){e=true;if(a(g[f],f)&&!g[f].disabled){j(g[f])}continue}if(e&&(g[f]===this.lastClick||g[f]===k)){e=false;break}if(e&&a(g[f],f)&&!g[f].disabled){j(g[f])}}}this.lastClick=k},destroy:function(){this.click_listener.stopObserving("click",this.onClickListener);this.click_listener.SmartChecks=this.click_listener.SmartChecks.select(function(c){return c!==this})}});return b})();SapphireLib.AjaxPanel=(function(){var c={},f={},a=false,k=1,d=null;function n(q){Object.keys(q).each(function(r){m($(r),true,q[r][0],q[r][1])})}d=SapphireLib.HistoryManager.registerPlugin("ajaxpanel",n);function i(){if(a){throw"Already in Transaction"}else{a=true;if(SapphireLib.AjaxPanel.useHistory){c=d.getCurrentState();f=d.getNextState()}else{c={};f={}}}}function b(){if(!a){return}if(SapphireLib.AjaxPanel.useHistory){d.changeState(c,f)}else{n(f)}c=null;f=null;a=false}function g(r){if(r){Event.stop(r)}var q=null;if(this.target){q=$(this.target)}else{q=this.up("div.ajaxpanel")}var s=this.action;if(!s){s=q.getAttribute("ajaxpanel:src");if(s){s=s.replace(/^([^\?]+)\?.*/,"$1")}}l(q,s,Form.serialize(this));return false}function e(r){if(r){Event.stop(r)}var q=null;if(this.target){q=$(this.target)}else{q=this.up("div.ajaxpanel")}var s=this.href;if(!s){s=q.getAttribute("ajaxpanel:src");if(s){s=s.replace(/^([^\?]+)\?.*/,"$1")}}l(q,s,"");return false}Event.addLoadEvent(function(){if($$("div.ajaxpanel").length){p()}});function p(r){var q=$$;if(!r){document.observe("dblclick",function(s){var t=s.element();if(t.match("div.ajaxpanel")&&t.match("div.ajaxpanel_dblrefresh")){h(t);return}t=t.up("div.ajaxpanel");if(t&&t.match("div.ajaxpanel_dblrefresh")){h(t);return}})}else{q=function(s){return r.select(s)}}q("a.ajaxpanel").each(function(s){s.observe("click",e.bindAsEventListener(s))});q("form.ajaxpanel").each(j);q("div.ajaxpanel").each(function(v){v.identify();v.load=l.curry(v);v.refresh=h.curry(v);var u=v.select("form.ajaxpanel_autosubmit");var t;var s=0;if(!!u&&u.length==1){u=u[0];t=u.action;if(!u.target){u.target=v.identify()}if(!t){t=v.getAttribute("ajaxpanel:src")}if(!s){s=u.getAttribute("ajaxpanel:delay")||0}if(s){m.delay(Number(s),v,true,t,Form.serialize(u))}else{m(v,true,t,Form.serialize(u))}}else{m(v,true,v.getAttribute("ajaxpanel:src"),v.getAttribute("ajaxpanel:post")||Form.serialize(v))}});if(!!r&&r.match("div.ajaxpanel")){r.select("form.ajaxpanel_autosubmit").each(function(v){v=r;var u=v.select("form.ajaxpanel_autosubmit");var t;var s=0;if(!!u&&u.length==1){u=u[0];t=u.action;if(!u.target){u.target=v.identify()}if(!t){t=v.getAttribute("ajaxpanel:src")}if(!s){s=u.getAttribute("ajaxpanel:delay")||0}if(s){m.delay(Number(s),v,true,t,Form.serialize(u))}else{m(v,true,t,Form.serialize(u))}}})}}function j(q){q._oldsubmit=q.submit;q.submit=g.bind(q);if(!q.target){q.target=q.up("div.ajaxpanel").identify()}}function o(q){q.submit=q._oldsubmit}function m(x,w,r,q){x=$(x);var s=r||x.getAttribute("ajaxpanel:src");if(!s){return}var v=q;if(v===null||Object.isUndefined(v)){v=x.getAttribute("ajaxpanel:post")}if((v===null||Object.isUndefined(v))){if(x.select("form.ajaxpanel").length==1){v=Form.serialize(x.select("form.ajaxpanel")[0])}else{v=Form.serialize(x)}}v=v||"";if(!w){if(s==x.getAttribute("ajaxpanel:src")&&v==x.getAttribute("ajaxpanel:post")){return}}x.setAttribute("ajaxpanel:src",s);x.setAttribute("ajaxpanel:post",v);if(!s.match(/tme=/)){s+=(s.match(/\?/)?"&":"?")+"tme="+Math.random()}var t=k++;x.setAttribute("ajaxpanel:currentreq",t);new Ajax.Request(s,{method:"post",parameters:v,asynchronous:true,onSuccess:function(u,y){if(x.getAttribute("ajaxpanel:currentreq")==t){x.select("form.ajaxpanel").each(o);x.fire("ajaxpanel:beforeunload");if(!y){x.update(u.responseText)}else{x.update(u.responseText)}x.fire("ajaxpanel:load");p(x)}},onFailure:function(u){if(x.getAttribute("ajaxpanel:currentreq")==t){alert("An error has occurred. Please try again.");x.select("form.ajaxpanel").each(o);x.update(u.responseText);x.select("form.ajaxpanel").each(j)}}})}function h(q){m(q,true,null,null)}function l(t,q,s){var r=false;if(!a){i();r=true}t=$(t);c[t.identify()]=[t.getAttribute("ajaxpanel:src"),t.getAttribute("ajaxpanel:post")];f[t.identify()]=[q,s];if(r){b()}}return{init:p,changePanel:l,refreshPanel:h,beginTransaction:i,commitTransaction:b,useHistory:true}})();Ajax.CFJSON=Class.create(Ajax.Request,{initialize:function($super,b,a){a.onComplete=(a.onComplete||Prototype.emptyFunction).bind(this).wrap(function(d,e,c){if(this.updateContent(e,c)){d(e,c)}}).bind(this);a.onFailure=(a.onFailure||this.failError).bind(this);$super(b,a)},failError:function(b,a){alert("Service request failed with status "+b.statusText)},updateContent:function(h,b){if(this.options.myDebug){alert("complete")}var g=h.responseText;var f=this.options.myCallbackElements||{};var e=h.responseJSON;if(!(typeof e==="object")){alert("Data retrieval error");return false}h.responseJSON=new CaseInsensitiveHashMap(e);e=h.responseJSON;var d=e.get("error");if((typeof d==="string")&&d.length>0){if(d==="false"){d=false}else{if(d==="true"){d=true}else{alert("Data retrieval error: "+d);return false}}}if((typeof d==="boolean")&&d){alert("Data retrieval error: "+e.get("message"));return false}if($("AJAX_DEV")&&e.containsKey("_debug")){$("AJAX_DEV").update(e.get("_debug"))}var a=e.get("result");if(a){if(this.options.myDebugDump){Object.dpDump(this,"obj",false,2)}var c=this.options.myDebug;$H(f).each(function(i){if(c){alert("Checking "+i.key+" "+i.value)}if(!$(i.value)){alert("Callback "+i.value+" doesn't exist")}else{if(typeof a[i.key]==="string"){$(i.value).value=a[i.key]}else{if(typeof a[i.key]==="number"){$(i.value).value=a[i.key]}else{alert("Invalid data type for "+i.key+" is "+typeof a[i.key])}}}})}return true}});(function(){Ajax.Responders.register({onCreate:function(a){if(!a._loadingbox&&(!a.options.noloadingbox)){var c=a.options.loadingtext||"Loading...";var b=(typeof CKEDITOR!=="undefined"?12000:1000);if(!Object.isUndefined(Windows)&&Windows.maxZIndex>b){b=Windows.maxZIndex+100}a._loadingbox=new SapphireControls.LoadingBox(c,{zIndex:b})}if(a._loadingbox){a._loadingbox.show()}},onFailure:function(a){if(a._loadingbox){a._loadingbox.hide();a._loadingbox=null}},onComplete:function(a){if(a._loadingbox){a._loadingbox.hide();a._loadingbox=null}}})})();(function(){jQuery(document).ajaxSend(function(a,c,b){if(!c._loadingbox&&(!b.noloadingbox)){var e=b.loadingtext||"Loading...";var d=(typeof CKEDITOR!=="undefined"?12000:1000);if(!Object.isUndefined(Windows)&&Windows.maxZIndex>d){d=Windows.maxZIndex+100}c._loadingbox=new SapphireControls.LoadingBox(e,{zIndex:d})}if(c._loadingbox){c._loadingbox.show()}}).ajaxComplete(function(a,c,b){if(c._loadingbox){c._loadingbox.hide();c._loadingbox=null}})})();SapphireLib.RepeatedUpdater=(function(){function b(){this.options.draggableSelectors.each(function(f){this.container.select(f).each(function(g){if(this._draggableCache[g.identify()]){this._draggableCache[g.identify()].destroy();delete this._draggableCache[g.identify()];g.isTTIDraggable=false}},this)},this)}function d(){this.options.draggableSelectors.each(function(f){this.container.select(f).each(function(g){if(!g.isTTIDraggable){this._draggableCache[g.identify()]=new Draggable(g,this.options.draggableOpt);g.isTTIDraggable=true}},this)},this)}function a(f,g){this._draggableCache={};this.container=$(f);this.options=Object.extend({draggableSelectors:[],draggableOpt:{revert:true,scroll:window,scrollSensitivity:40},ajaxPage:"",ajaxOpt:{},randParam:null},g||{});this.options.ajaxOpt.onSuccess=(Object.isFunction(this.options.ajaxOpt.onSuccess)?this.options.ajaxOpt.onSuccess:Prototype.emptyFunction).wrap(function(j,h,i){this.removeOrphanedDraggables();this.removeDroppables();j(h,i)}.bind(this));this.options.ajaxOpt.onFailure=(Object.isFunction(this.options.ajaxOpt.onFailure)?this.options.ajaxOpt.onFailure:Prototype.emptyFunction).wrap(function(j,h,i){this.removeOrphanedDraggables();this.removeDroppables();j(h,i)}.bind(this));this.options.ajaxOpt.onComplete=(Object.isFunction(this.options.ajaxOpt.onComplete)?this.options.ajaxOpt.onComplete:Prototype.emptyFunction).wrap(function(j,h,i){this.addDraggables();this.addDroppables();j(h,i)}.bind(this))}function c(f,h){var g=Object.clone(f||{});g.parameters=(g.parameters?Object.clone(g.parameters):{});if(this.options.randParam){g.parameters[this.options.randParam]=Math.random()}Object.extend(g.parameters,h);new Ajax.Updater(this.container,this.options.ajaxPage,g)}function e(){return this.submitRequestWithOpt(this.options.ajaxOpt)}return Class.create({initialize:a,submitRequest:e,submitRequestWithOpt:c,update:e,removeOrphanedDraggables:b,addDraggables:d,addDroppables:function(){},removeDroppables:function(){}})})();var jqueryWindow=function(a,g){var j=a||"Sapphire-Dialog-Popup";var c=g||{};var b="";if(typeof $J=="undefined"){console.log("$J is undefined and is required for jqueryWindow");return false}if($J("#"+j).length===0){b=$J("<div/>",{id:j});$J("body").append(b)}else{b=$J("#"+j)}var i={};i.autoOpen=c.autoOpen||false;i.height=c.height||600;i.title=c.title||"";i.resizable=c.resizable||true;i.width=c.width||600;i.modal=c.modal||true;i.open=c.open||function(){};i.buttons=c.buttons||{Done:function(){$J(b).dialog("close")}};i.beforeClose=c.beforeClose||function(){};i.close=c.close||function(){$J(b).dialog("destroy");$J(b).remove()};i.create=c.create||function(k,l){};i.drag=c.drag||function(k,l){};i.dragStart=c.dragStart||function(k,l){};i.dragStop=c.dragStop||function(k,l){};i.focus=c.focus||function(k,l){};$J(b).dialog(i);var f=c.ajaxContentUrl||"";var d=c.ajaxContentParams||{};var h=c.ajaxContentMethod||"POST";var e=c.htmlContent||"";c.callback=c.callback||function(){};if(f.length>0){$J.ajax({url:f,data:d,method:h,cache:false,dataType:"html"}).done(function(k){$J(b).html(k)}).fail(function(k,m,l){$J(b).html("Error: "+m+":"+l)}).always(function(){c.callback();$J(b).dialog("open")})}else{$J(b).html(e);c.callback();$J(b).dialog("open")}return $J(b)};window.jqueryConfirm=function(b,c,a){a=a||"Confirmation";c=c||function(){};$J(document.createElement("div")).attr({title:a,"class":"dialog"}).html(b).dialog({position:["center",100],dialogClass:"fixed",buttons:{OK:function(){$J(this).dialog("close");c();return true},Cancel:function(){$J(this).dialog("close");return false}},close:function(){$J(this).dialog("destroy");$J(this).remove()},draggable:false,modal:true,resizable:false,width:500,height:200})};window.alert=function(b,c,a){a=a||"Sapphire Alert";c=c||function(){};$J(document.createElement("div")).attr({title:a,"class":"dialog"}).html(b).dialog({position:["center",100],dialogClass:"fixed",buttons:{OK:function(){$J(this).dialog("close");c();return true}},close:function(){$J(this).dialog("destroy");$J(this).remove()},draggable:false,modal:true,resizable:false,width:500,height:200})};